
# CockroachDB node by HTTP

## Overview

For Zabbix version: 6.0 and higher  
The template to monitor CockroachDB nodes by Zabbix that works without any external scripts.
Most of the metrics are collected in one go, thanks to Zabbix bulk data collection.

Template `CockroacDB node by HTTP` â€” collects metrics by HTTP agent from Prometheus endpoint and health endpoints.


This template was tested on:

- CockroachDB node, version 21.2.8

## Setup

> See [Zabbix template operation](https://www.zabbix.com/documentation/6.0/manual/config/templates_out_of_the_box/http) for basic instructions.

Internal node metrics are collected from Prometheus /_status/vars endpoint.
Node health metrics are collected from /health and /health?ready=1 endpoints.
Template doesn't require usage of authentication cookie.

Don't forget change macros {$COCKROACHDB.API.SCHEME} according to your situation (secure/insecure node).
Also, see the Macros section for a list of macros used to set trigger values.
*NOTE.* Some metrics may not be collected depending on your CockroachDB version and configuration.


## Zabbix configuration

No specific Zabbix configuration is required.

### Macros used

|Name|Description|Default|
|----|-----------|-------|
|{$COCKROACHDB.API.PORT} |<p>The port of CockroachDB API and Prometheus endpoint</p> |`8080` |
|{$COCKROACHDB.API.SCHEME} |<p>Request scheme which may be http or https</p> |`http` |
|{$COCKROACHDB.CERT.EXPIRY.WARN} |<p>Number of days until the certificates expire.</p> |`7` |
|{$COCKROACHDB.DISK.USED.WARN} |<p>The threshold of the available disk space utilization in percent</p> |`85` |

## Template links

There are no template links in this template.

## Discovery rules

|Name|Description|Type|Key and additional info|
|----|-----------|----|----|
|Certificates discovery |<p>Discovery certificates expiration dates.</p> |DEPENDENT |cockroachdb.node.cert.discovery<p>**Preprocessing**:</p><p>- PROMETHEUS_TO_JSON: `{__name__=~ "^security_certificate_expiration_*"}`</p><p>- JAVASCRIPT: `The text is too long. Please see the template.`</p><p>- DISCARD_UNCHANGED_HEARTBEAT: `3h`</p><p>**Overrides:**</p><p>ca cert<br> - {#TYPE} MATCHES_REGEX `ca`<br>  - ITEM_PROTOTYPE LIKE `CA` - DISCOVER</p><p>node cert<br> - {#TYPE} MATCHES_REGEX `node`<br>  - ITEM_PROTOTYPE LIKE `node` - DISCOVER</p> |
|Command commit latency buckets discovery |<p>Discovery buckets of latency histogram for committing Raft commands.</p> |DEPENDENT |cockroachdb.node.command.latency.buckets.discovery<p>**Preprocessing**:</p><p>- PROMETHEUS_TO_JSON: `raft_process_commandcommit_latency_bucket{le=~".*"}`</p><p>- DISCARD_UNCHANGED_HEARTBEAT: `3h`</p> |
|Command commit latency percentile discovery |<p>Discovery percentile items of latency histogram for committing Raft commands.</p> |DEPENDENT |cockroachdb.node.command.percentile.discovery<p>**Preprocessing**:</p><p>- PROMETHEUS_TO_JSON: `raft_process_commandcommit_latency_count`</p><p>- JAVASCRIPT: `The text is too long. Please see the template.`</p><p>- DISCARD_UNCHANGED_HEARTBEAT: `3h`</p><p>**Overrides:**</p><p>total item<br> - {#TYPE} MATCHES_REGEX `totals`<br>  - ITEM_PROTOTYPE NOT_LIKE `bucket` - DISCOVER</p> |
|KV execution latency buckets discovery |<p>Discovery buckets of latency histogram of batch KV requests executed on this node.</p> |DEPENDENT |cockroachdb.node.kv.exec.latency.buckets.discovery<p>**Preprocessing**:</p><p>- PROMETHEUS_TO_JSON: `exec_latency_bucket{le=~".*"}`</p><p>- DISCARD_UNCHANGED_HEARTBEAT: `3h`</p> |
|KV execution latency percentile discovery |<p>Discovery percentile items of latency histogram of batch KV requests executed on this node.</p> |DEPENDENT |cockroachdb.node.kv.exec.latency.percentile.discovery<p>**Preprocessing**:</p><p>- PROMETHEUS_TO_JSON: `exec_latency_count`</p><p>- JAVASCRIPT: `The text is too long. Please see the template.`</p><p>- DISCARD_UNCHANGED_HEARTBEAT: `3h`</p><p>**Overrides:**</p><p>total item<br> - {#TYPE} MATCHES_REGEX `totals`<br>  - ITEM_PROTOTYPE NOT_LIKE `bucket` - DISCOVER</p> |
|KV transactional durations buckets discovery |<p>Discovery buckets of KV transaction durations.</p> |DEPENDENT |cockroachdb.node.kv.durations.buckets.discovery<p>**Preprocessing**:</p><p>- PROMETHEUS_TO_JSON: `txn_durations_bucket{le=~".*"}`</p><p>- DISCARD_UNCHANGED_HEARTBEAT: `3h`</p> |
|KV transactional durations percentile discovery |<p>Discovery percentile items of KV transaction durations.</p> |DEPENDENT |cockroachdb.node.kv.durations.percentile.discovery<p>**Preprocessing**:</p><p>- PROMETHEUS_TO_JSON: `txn_durations_count`</p><p>- JAVASCRIPT: `The text is too long. Please see the template.`</p><p>- DISCARD_UNCHANGED_HEARTBEAT: `3h`</p><p>**Overrides:**</p><p>total item<br> - {#TYPE} MATCHES_REGEX `totals`<br>  - ITEM_PROTOTYPE NOT_LIKE `bucket` - DISCOVER</p> |
|Log commit latency buckets discovery |<p>Discovery buckets of histogram for committing Raft log entries latency.</p> |DEPENDENT |cockroachdb.node.log.buckets.discovery<p>**Preprocessing**:</p><p>- PROMETHEUS_TO_JSON: `raft_process_logcommit_latency_bucket{le=~".*"}`</p><p>- DISCARD_UNCHANGED_HEARTBEAT: `3h`</p> |
|Log commit latency percentile discovery |<p>Discovery percentile items of histogram for committing Raft log entries latency.</p> |DEPENDENT |cockroachdb.node.log.percentile.discovery<p>**Preprocessing**:</p><p>- PROMETHEUS_TO_JSON: `raft_process_logcommit_latency_count`</p><p>- JAVASCRIPT: `The text is too long. Please see the template.`</p><p>- DISCARD_UNCHANGED_HEARTBEAT: `3h`</p><p>**Overrides:**</p><p>total item<br> - {#TYPE} MATCHES_REGEX `totals`<br>  - ITEM_PROTOTYPE NOT_LIKE `bucket` - DISCOVER</p> |
|Node heartbeat latency buckets discovery |<p>Discovery buckets of node liveness heartbeat latency histogram.</p> |DEPENDENT |cockroachdb.node.heartbeat.buckets.discovery<p>**Preprocessing**:</p><p>- PROMETHEUS_TO_JSON: `liveness_heartbeatlatency_bucket{le=~".*"}`</p><p>- DISCARD_UNCHANGED_HEARTBEAT: `3h`</p> |
|Node heartbeat latency percentile discovery |<p>Discovery percentile items of node liveness heartbeat latency histogram.</p> |DEPENDENT |cockroachdb.node.heartbeat.percentile.discovery<p>**Preprocessing**:</p><p>- PROMETHEUS_TO_JSON: `liveness_heartbeatlatency_count`</p><p>- JAVASCRIPT: `The text is too long. Please see the template.`</p><p>- DISCARD_UNCHANGED_HEARTBEAT: `3h`</p><p>**Overrides:**</p><p>total item<br> - {#TYPE} MATCHES_REGEX `totals`<br>  - ITEM_PROTOTYPE NOT_LIKE `bucket` - DISCOVER</p> |
|SQL service latency buckets discovery |<p>Discovery buckets of SQL request execution latency histogram.</p> |DEPENDENT |cockroachdb.node.sql.buckets.discovery<p>**Preprocessing**:</p><p>- PROMETHEUS_TO_JSON: `sql_service_latency_bucket{le=~".*"}`</p><p>- DISCARD_UNCHANGED_HEARTBEAT: `3h`</p> |
|SQL service latency percentile discovery |<p>Discovery percentile items of SQL request execution latency histogram.</p> |DEPENDENT |cockroachdb.node.sql.percentile.discovery<p>**Preprocessing**:</p><p>- PROMETHEUS_TO_JSON: `sql_service_latency_count`</p><p>- JAVASCRIPT: `The text is too long. Please see the template.`</p><p>- DISCARD_UNCHANGED_HEARTBEAT: `3h`</p><p>**Overrides:**</p><p>total item<br> - {#TYPE} MATCHES_REGEX `totals`<br>  - ITEM_PROTOTYPE NOT_LIKE `bucket` - DISCOVER</p> |
|Transaction latency buckets discovery |<p>Discovery buckets of SQL transactions latency histogram.</p> |DEPENDENT |cockroachdb.node.transaction.buckets.discovery<p>**Preprocessing**:</p><p>- PROMETHEUS_TO_JSON: `sql_txn_latency_bucket{le=~".*"}`</p><p>- DISCARD_UNCHANGED_HEARTBEAT: `3h`</p> |
|Transaction latency percentile discovery |<p>Discovery percentile items of SQL transactions latency histogram.</p> |DEPENDENT |cockroachdb.node.transaction.percentile.discovery<p>**Preprocessing**:</p><p>- PROMETHEUS_TO_JSON: `sql_txn_latency_count`</p><p>- JAVASCRIPT: `The text is too long. Please see the template.`</p><p>- DISCARD_UNCHANGED_HEARTBEAT: `3h`</p><p>**Overrides:**</p><p>total item<br> - {#TYPE} MATCHES_REGEX `totals`<br>  - ITEM_PROTOTYPE NOT_LIKE `bucket` - DISCOVER</p> |

## Items collected

|Group|Name|Description|Type|Key and additional info|
|-----|----|-----------|----|---------------------|
|CockroachDB node |CockroachDB node: Service ping |<p>-</p> |SIMPLE |net.tcp.service["{$COCKROACHDB.API.SCHEME}","{HOST.CONN}","{$COCKROACHDB.API.PORT}"]<p>**Preprocessing**:</p><p>- DISCARD_UNCHANGED_HEARTBEAT: `10m`</p> |
|CockroachDB node |CockroachDB node: Batches |<p>Number of batches processed per second.</p> |DEPENDENT |cockroachdb.node.batches<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `distsender_batches`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Partial batches |<p>Number of partial batches processed per second after being divided on range boundaries.</p> |DEPENDENT |cockroachdb.node.batches.partial<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `distsender_batches_partial`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Changefeed emmited messages |<p>Messages emitted by all feeds.</p> |DEPENDENT |cockroachdb.node.changefeed.emmited_messages<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `changefeed_emitted_messages`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Changefeed flushes |<p>Total flushes across all feeds.</p> |DEPENDENT |cockroachdb.node.changefeed.flushes<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `changefeed_flushes`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Changefeed flushes |<p>Total flushes across all feeds.</p> |DEPENDENT |cockroachdb.node.changefeed.flushes<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `changefeed_flushes`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Max changefeed latency |<p>Largest commit-to-emit duration of any running feed.</p> |DEPENDENT |cockroachdb.node.changefeed.latency_max<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `changefeed_max_behind_nanos`: `value`: ``</p><p>- CHANGE_PER_SECOND</p><p>- MULTIPLIER: `0.000000001`</p> |
|CockroachDB node |CockroachDB node: Changefeed restarts |<p>Number of changefeed jobs which failed with a retriable error.</p> |DEPENDENT |cockroachdb.node.changefeed.restarts<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `jobs_changefeed_resume_retry_error`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Clock offset |<p>Mean clock offset of the node against the rest of the cluster.</p> |DEPENDENT |cockroachdb.node.clock.offset<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `clock_offset_meannanos`: `value`: ``</p><p>- MULTIPLIER: `0.000000001`</p> |
|CockroachDB node |CockroachDB node: CockroachDB version |<p>Build information.</p> |DEPENDENT |cockroachdb.node.version<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `build_timestamp`: `label`: `tag`</p> |
|CockroachDB node |CockroachDB node: Compactions |<p>The number of compactions per second.</p> |DEPENDENT |cockroachdb.node.compactions<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `rocksdb_compactions{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Consistency checker queue (pending actions) |<p>Number of pending replicas in the consistency checker queue.</p> |DEPENDENT |cockroachdb.node.queue.consistency_checker.actions.pending<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_consistency_pending{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Consistency checker queue (successful actions) |<p>Number of replicas successfully processed by the consistency checker queue.</p> |DEPENDENT |cockroachdb.node.queue.consistency_checker.actions.successful<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_consistency_process_success{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: System CPU time |<p>System CPU time.</p> |DEPENDENT |cockroachdb.node.cpu.system_time<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_cpu_sys_ns`: `value`: ``</p><p>- CHANGE_PER_SECOND</p><p>- MULTIPLIER: `0.000000001`</p> |
|CockroachDB node |CockroachDB node: User CPU time |<p>User CPU time.</p> |DEPENDENT |cockroachdb.node.cpu.user_time<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_cpu_user_ns`: `value`: ``</p><p>- CHANGE_PER_SECOND</p><p>- MULTIPLIER: `0.000000001`</p> |
|CockroachDB node |CockroachDB node: CPU utilization |<p>CPU utilization in %</p> |DEPENDENT |cockroachdb.node.cpu.util<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_cpu_combined_percent_normalized`: `value`: ``</p><p>- MULTIPLIER: `100`</p> |
|CockroachDB node |CockroachDB node: Live bytes |<p>Number of logical bytes stored in live key-value pairs (https://www.cockroachlabs.com/docs/v21.1/architecture/distribution-layer.html#table-data) on this node. Live data excludes historical and deleted data.</p> |DEPENDENT |cockroachdb.node.disk.bytes.live<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `livebytes{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: System bytes |<p>Number of physical bytes stored in system key-value pairs (https://www.cockroachlabs.com/docs/v21.1/architecture/distribution-layer.html#table-data).</p> |DEPENDENT |cockroachdb.node.disk.bytes.system<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sysbytes{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Available disk capacity |<p>Available disk capacity.</p> |DEPENDENT |cockroachdb.node.disk.capacity.available<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `capacity_available{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Maximum disk capacity |<p>Maximum store size across all nodes. This value may be explicitly set per node using --store (https://www.cockroachlabs.com/docs/v21.1/cockroach-start.html#store). If a store size has not been set, this metric displays the actual disk capacity.</p> |DEPENDENT |cockroachdb.node.disk.capacity.max<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `capacity{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Used disk capacity |<p>Disk space in use by CockroachDB data on this node. This excludes the Cockroach binary, operating system, and other system files.</p> |DEPENDENT |cockroachdb.node.disk.capacity.used<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `capacity_used{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Disk operations in progress |<p>Number of disk IOPS in progress.</p> |DEPENDENT |cockroachdb.node.disk.iops.in_progress<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_host_disk_iopsinprogress`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Disk read rate |<p>Disk read rate.</p> |DEPENDENT |cockroachdb.node.disk.read.rate<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_host_disk_read_bytes`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Disk read IOPS |<p>Number of disk read operations per second.</p> |DEPENDENT |cockroachdb.node.disk.read.iops<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_host_disk_read_count`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Disk write rate |<p>Disk write rate.</p> |DEPENDENT |cockroachdb.node.disk.write.rate<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_host_disk_write_bytes`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Disk write IOPS |<p>Number of disk write operations per second.</p> |DEPENDENT |cockroachdb.node.disk.write.iops<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_host_disk_write_count`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Write stalls |<p>Number of instances of intentional write stalls to backpressure incoming writes.</p> |DEPENDENT |cockroachdb.node.disk.write.stalls<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `storage_write_stalls{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: File descriptors limit |<p>The file descriptor limit.</p> |DEPENDENT |cockroachdb.node.descriptors.limit<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_fd_softlimit`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: Open file descriptors |<p>The number of open file descriptors.</p> |DEPENDENT |cockroachdb.node.descriptors.open<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_fd_open`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: Flushes |<p>The number of memtable flushes per second.</p> |DEPENDENT |cockroachdb.node.flushes<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `rocksdb_flushes{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: GC pause time |<p>The amount of processor time used by Go's garbage collector per second across all nodes. During garbage collection, application code execution is paused.</p> |DEPENDENT |cockroachdb.node.gc.pause_time<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_gc_pause_ns`: `value`: ``</p><p>- CHANGE_PER_SECOND</p><p>- MULTIPLIER: `0.000000001`</p> |
|CockroachDB node |CockroachDB node: GC queue (pending actions) |<p>Number of pending replicas in the GC queue.</p> |DEPENDENT |cockroachdb.node.gc.actions.pending<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_gc_pending{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: GC queue (successful actions) |<p>Number of replicas successfully processed by the GC queue.</p> |DEPENDENT |cockroachdb.node.gc.actions.successful<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_gc_process_success{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: GC runs |<p>The number of times that Go's garbage collector was invoked per second across all nodes.</p> |DEPENDENT |cockroachdb.node.gc.runs<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_gc_count`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Goroutine count |<p>The number of Goroutines across all nodes. This count should rise and fall based on load.</p> |DEPENDENT |cockroachdb.node.goroutines.count<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_goroutines`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: Runnable Goroutines per CPU |<p>The number of Goroutines waiting for CPU. This count should rise and fall based on load.</p> |DEPENDENT |cockroachdb.node.goroutines.runnable<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_runnable_goroutines_per_cpu`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: KV transactions aborted |<p>Number of aborted KV transactions per second.</p> |DEPENDENT |cockroachdb.node.transcactions.kv.aborted<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `txn_aborts`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: KV transactions commited |<p>Number of KV transactions (including 1PC) commited per second.</p> |DEPENDENT |cockroachdb.node.transcactions.kv.commited<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `txn_commits`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: KV transactions commited fast-path |<p>Number of KV transaction one-phase commit attempts per second.</p> |DEPENDENT |cockroachdb.node.transcactions.kv.commited.fastpath<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `txn_commits1PC`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: KV transaction restarts (async consensus failures) |<p>Number of restarts due to async consensus writes that failed to leave intents.</p> |DEPENDENT |cockroachdb.node.transcactions.kv.restarts.asyncwritefailure<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `txn_restarts_asyncwritefailure`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: KV transaction restarts (read within uncertainty interval) |<p>Number of restarts due to reading a new value within the uncertainty interval.</p> |DEPENDENT |cockroachdb.node.transcactions.kv.restarts.readwithinuncertainty<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `txn_restarts_readwithinuncertainty`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: KV transaction restarts (forwarded timestamp, iso=serializable) |<p>Number of restarts due to a forwarded commit timestamp and isolation=SERIALIZABLE.</p> |DEPENDENT |cockroachdb.node.transcactions.kv.restarts.serializable<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `txn_restarts_serializable`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: KV transaction restarts (aborted) |<p>Number of restarts due to an abort by a concurrent transaction (usually due to deadlock).</p> |DEPENDENT |cockroachdb.node.transcactions.kv.restarts.txnaborted<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `txn_restarts_txnaborted`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: KV transaction restarts (push failure) |<p>Number of restarts due to a transaction push failure.</p> |DEPENDENT |cockroachdb.node.transcactions.kv.restarts.txnpush<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `txn_restarts_txnpush`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: KV transaction restarts (unknown) |<p>Number of restarts due to a unknown reasons.</p> |DEPENDENT |cockroachdb.node.transcactions.kv.restarts.unknown<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `txn_restarts_unknown`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: KV transaction restarts (write too old) |<p>Number of restarts due to a concurrent writer committing first.</p> |DEPENDENT |cockroachdb.node.transcactions.kv.restarts.writetooold<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `txn_restarts_writetooold`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: KV transaction restarts (write too old, multiple) |<p>Number of restarts due to multiple concurrent writers committing first.</p> |DEPENDENT |cockroachdb.node.transcactions.kv.restarts.writetoooldmulti<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `txn_restarts_writetoooldmulti`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Leaders w/o lease |<p>Number of replicas that are Raft leaders whose range lease is held by another store.</p> |DEPENDENT |cockroachdb.node.transcactions.leases.leaders_without_lease<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `replicas_leaders_not_leaseholders{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Lease holders |<p>Number of lease holders.</p> |DEPENDENT |cockroachdb.node.transcactions.leases.holders<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `replicas_leaseholders{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Lease transfers |<p>Number of successful lease transfers.</p> |DEPENDENT |cockroachdb.node.transcactions.leases.transfers<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `leases_transfers_success{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Load-based lease transfers |<p>Number of lease transfers motivated by store-level load imbalances.</p> |DEPENDENT |cockroachdb.node.transcactions.leases.transfers_rebalancing<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `rebalancing_lease_transfers{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Load-based lease transfers |<p>Number of lease transfers motivated by store-level load imbalances.</p> |DEPENDENT |cockroachdb.node.transcactions.leases.transfers_rebalancing<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `rebalancing_lease_transfers{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Live nodes count |<p>The number of live nodes in the cluster.</p> |DEPENDENT |cockroachdb.node.live_count<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `liveness_livenodes`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: Logical bytes |<p>Number of logical bytes stored in key-value pairs (https://www.cockroachlabs.com/docs/v21.1/architecture/distribution-layer.html#table-data) on this node. This includes historical and deleted data.</p> |DEPENDENT |cockroachdb.node.disk.bytes.logical<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `totalbytes{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Memory allocated by CGo |<p>Memory allocated by the C layer.</p> |DEPENDENT |cockroachdb.node.memory.cgo.allocated<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_cgo_allocbytes`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: Memory allocated by Go |<p>Memory allocated by the Go layer.</p> |DEPENDENT |cockroachdb.node.memory.go.allocated<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_go_allocbytes`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: Memory managed by CGo |<p>Total memory managed by the C layer.</p> |DEPENDENT |cockroachdb.node.memory.cgo.managed<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_cgo_totalbytes`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: Memory managed by Go |<p>Total memory managed by the Go layer.</p> |DEPENDENT |cockroachdb.node.memory.go.managed<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_go_totalbytes`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: Total memory usage |<p>Resident set size (RSS) of memory in use by the node.</p> |DEPENDENT |cockroachdb.node.memory.total<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_rss`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: Merge queue (pending actions) |<p>Number of pending replicas in the merge queue.</p> |DEPENDENT |cockroachdb.node.queue.merge.actions.pending<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_merge_pending{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Merge queue (successful actions) |<p>Number of replicas successfully processed by the merge queue.</p> |DEPENDENT |cockroachdb.node.queue.merge.actions.successful<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_merge_process_success{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Network bytes received |<p>Amount of incoming network traffic per second.</p> |DEPENDENT |cockroachdb.node.network.bytes.received<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_host_net_recv_bytes`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Network bytes sent |<p>Amount of outgoing network traffic per second.</p> |DEPENDENT |cockroachdb.node.network.bytes.sent<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_host_net_send_bytes`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Not lease holder errors |<p>Number of NotLeaseHolderErrors encountered per second.</p> |DEPENDENT |cockroachdb.node.transcactions.leases.notleaseholder<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `distsender_errors_notleaseholder`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Average queries |<p>Exponentially weighted moving average of the number of KV batch requests processed by leaseholder replicas on each store per second. Tracks roughly the last 30 minutes of requests. Used for load-based rebalancing decisions.</p> |DEPENDENT |cockroachdb.node.queries.average<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `rebalancing_queriespersecond{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Queue processing failures (consistency) |<p>Number of replicas which failed processing in the consistency checker queue.</p> |DEPENDENT |cockroachdb.node.queue.processing_failures.consistency<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_consistency_process_failure{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Queue processing failures (GC) |<p>Number of replicas which failed processing in the GC queue.</p> |DEPENDENT |cockroachdb.node.queue.processing_failures.gc<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_gc_process_failure{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Queue processing failures (Raft log) |<p>Number of replicas which failed processing in the Raft log queue.</p> |DEPENDENT |cockroachdb.node.queue.processing_failures.raftlog<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_raftlog_process_failure{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Queue processing failures (Raft snapshot) |<p>Number of replicas which failed processing in the Raft repair queue.</p> |DEPENDENT |cockroachdb.node.queue.processing_failures.raftsnapshot<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_raftsnapshot_process_failure{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Queue processing failures (replica GC) |<p>Number of replicas which failed processing in the replica GC queue.</p> |DEPENDENT |cockroachdb.node.queue.processing_failures.gc_replica<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_replicagc_process_failure{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Queue processing failures (replicate) |<p>Number of replicas which failed processing in the replicate queue.</p> |DEPENDENT |cockroachdb.node.queue.processing_failures.replicate<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_replicate_process_failure{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Queue processing failures (split) |<p>Number of replicas which failed processing in the split queue.</p> |DEPENDENT |cockroachdb.node.queue.processing_failures.split<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_split_process_failure{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Queue processing failures (time series maintenance) |<p>Number of replicas which failed processing in the time series maintenance queue.</p> |DEPENDENT |cockroachdb.node.queue.processing_failures.tsmaintenance<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_tsmaintenance_process_failure{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Queue processing time (consistency) |<p>Time spent processing replicas in the consistency checker queue.</p> |DEPENDENT |cockroachdb.node.queue.processing_time.consistency<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_consistency_processingnanos{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p><p>- MULTIPLIER: `0.000000001`</p> |
|CockroachDB node |CockroachDB node: Queue processing time (GC) |<p>Time spent processing replicas in the GC queue.</p> |DEPENDENT |cockroachdb.node.queue.processing_time.gc<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_gc_processingnanos{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p><p>- MULTIPLIER: `0.000000001`</p> |
|CockroachDB node |CockroachDB node: Queue processing time (Raft log) |<p>Time spent processing replicas in the Raft log queue.</p> |DEPENDENT |cockroachdb.node.queue.processing_time.raftlog<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_raftlog_processingnanos{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p><p>- MULTIPLIER: `0.000000001`</p> |
|CockroachDB node |CockroachDB node: Queue processing time (Raft snapshot) |<p>Time spent processing replicas in the Raft repair queue.</p> |DEPENDENT |cockroachdb.node.queue.processing_time.raftsnapshot<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_raftsnapshot_processingnanos{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p><p>- MULTIPLIER: `0.000000001`</p> |
|CockroachDB node |CockroachDB node: Queue processing time (replica GC) |<p>Time spent processing replicas in the replica GC queue.</p> |DEPENDENT |cockroachdb.node.queue.processing_time.gc_replica<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_replicagc_processingnanos{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p><p>- MULTIPLIER: `0.000000001`</p> |
|CockroachDB node |CockroachDB node: Queue processing time (replicate) |<p>Time spent processing replicas in the replicate queue.</p> |DEPENDENT |cockroachdb.node.queue.processing_time.replicate<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_replicate_processingnanos{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p><p>- MULTIPLIER: `0.000000001`</p> |
|CockroachDB node |CockroachDB node: Queue processing time (split) |<p>Time spent processing replicas in the split queue.</p> |DEPENDENT |cockroachdb.node.queue.processing_time.split<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_split_processingnanos{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p><p>- MULTIPLIER: `0.000000001`</p> |
|CockroachDB node |CockroachDB node: Queue processing time (time series maintenance) |<p>Time spent processing replicas in the time series maintenance queue.</p> |DEPENDENT |cockroachdb.node.queue.processing_time.tsmaintenance<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_tsmaintenance_processingnanos{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p><p>- MULTIPLIER: `0.000000001`</p> |
|CockroachDB node |CockroachDB node: Raft leaders |<p>Number of raft leaders.</p> |DEPENDENT |cockroachdb.node.queue.raft.leaders<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `replicas_leaders{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Raft log queue (pending actions) |<p>Number of pending replicas in the Raft log queue.</p> |DEPENDENT |cockroachdb.node.queue.raftlog.actions.pending<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_raftlog_pending{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Raft log queue (successful actions) |<p>Number of replicas successfully processed by the Raft log queue.</p> |DEPENDENT |cockroachdb.node.queue.raftlog.actions.successful<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_raftlog_process_success{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Raft snapshot queue (pending actions) |<p>Number of pending replicas in the Raft repair queue.</p> |DEPENDENT |cockroachdb.node.queue.raftsnapshot.actions.pending<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_raftsnapshot_pending{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Raft snapshot queue (successful actions) |<p>Number of replicas successfully processed by the Raft repair queue.</p> |DEPENDENT |cockroachdb.node.queue.raftsnapshot.actions.successful<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_raftsnapshot_process_success{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Ranges |<p>Number of ranges.</p> |DEPENDENT |cockroachdb.node.ranges<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `ranges{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Ranges over-replicated |<p>Number of ranges with more live replicas than the replication target.</p> |DEPENDENT |cockroachdb.node.ranges.overreplicated<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `ranges_overreplicated{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Ranges unavaliable |<p>Number of ranges with fewer live replicas than needed for quorum.</p> |DEPENDENT |cockroachdb.node.ranges.unavaliable<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `ranges_unavailable{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Ranges under-replicated |<p>Number of ranges with fewer live replicas than the replication target.</p> |DEPENDENT |cockroachdb.node.ranges.underreplicated<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `ranges_underreplicated{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Range additions |<p>Number of range additions.</p> |DEPENDENT |cockroachdb.node.ranges.additions<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `range_adds{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Range merges |<p>Number of range merges.</p> |DEPENDENT |cockroachdb.node.ranges.merges<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `range_merges{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Load-based range rebalances |<p>Number of range rebalance operations motivated by store-level load imbalances.</p> |DEPENDENT |cockroachdb.node.ranges.rebalances<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `rebalancing_range_rebalances{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Range removals |<p>Number of range removals.</p> |DEPENDENT |cockroachdb.node.ranges.removals<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `range_removes{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Range splits |<p>Number of range splits.</p> |DEPENDENT |cockroachdb.node.ranges.splits<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `range_splits{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Read amplification |<p>The average number of real read operations executed per logical read operation.</p> |DEPENDENT |cockroachdb.node.read_amp<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `rocksdb_read_amplification{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Replicas |<p>Number of replicas.</p> |DEPENDENT |cockroachdb.node.replication.replicas<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `replicas{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Quiesced replicas |<p>Number of quiesced replicas.</p> |DEPENDENT |cockroachdb.node.replication.replicas.quiesced<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `replicas_quiescent{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Reserved replicas |<p>Number of replicas reserved for snapshots.</p> |DEPENDENT |cockroachdb.node.replication.replicas.reserved<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `replicas_reserved{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Replication queue (replica additions) |<p>Number of replica additions attempted by the replicate queue.</p> |DEPENDENT |cockroachdb.node.replication.queue.replicas.additions<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_replicate_addreplica{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Replication queue (dead replica removals) |<p>Number of dead replica removals attempted by the replicate queue (typically in response to a node outage).</p> |DEPENDENT |cockroachdb.node.replication.queue.replicas.dead_removals<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_replicate_removedeadreplica{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Replication queue (learner replica removals) |<p>Number of learner replica removals attempted by the replicate queue (typically due to internal race conditions).</p> |DEPENDENT |cockroachdb.node.replication.queue.replicas.learner_removals<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_replicate_removelearnerreplica{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Replication queue (leases transfered) |<p>Number of range lease transfers attempted by the replicate queue.</p> |DEPENDENT |cockroachdb.node.replication.queue.replicas.leases_transfered<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_replicate_transferlease{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Replication queue (pending actions) |<p>Number of pending replicas in the replicate queue.</p> |DEPENDENT |cockroachdb.node.replication.queue.replicas.pending<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_replicate_pending{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Replication queue (replicas in purgatory) |<p>Number of replicas in the replicate queue's purgatory, awaiting allocation options.</p> |DEPENDENT |cockroachdb.node.replication.queue.replicas.purgatory<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_replicate_purgatory{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Replication queue (replicas rebalanced) |<p>Number of replica rebalancer-initiated additions attempted by the replicate queue.</p> |DEPENDENT |cockroachdb.node.replication.queue.replicas.rebalanced<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_replicate_rebalancereplica{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Replication queue (replica removals) |<p>Number of replica removals attempted by the replicate queue (typically in response to a rebalancer-initiated addition).</p> |DEPENDENT |cockroachdb.node.replication.queue.replicas.removals<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_replicate_removereplica{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Replication queue (successful actions) |<p>Number of replicas successfully processed by the replicate queue.</p> |DEPENDENT |cockroachdb.node.replication.queue.replicas.successful<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_replicate_process_success{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Replica GC queue (pending actions) |<p>Number of GC'able entries corresponding to pending txns.</p> |DEPENDENT |cockroachdb.node.replication.gc_queue.actions.pending<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_gc_info_transactionspangcpending{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Replica GC queue (successful actions) |<p>Number of GC'able entries corresponding to committed txns.</p> |DEPENDENT |cockroachdb.node.replication.gc_queue.actions.successful<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_gc_info_transactionspangccommitted{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: RPCs errors |<p>Number of RPCs sent per second due to per-replica errors.</p> |DEPENDENT |cockroachdb.node.rpc.errors<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `distsender_rpc_sent_nextreplicaerror`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Local RPCs sent |<p>Number of local RPCs sent per second.</p> |DEPENDENT |cockroachdb.node.rpc.sent.local<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `distsender_rpc_sent_local`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: RPCs sent |<p>Number of RPCs sent per second.</p> |DEPENDENT |cockroachdb.node.rpc.sent<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `distsender_rpc_sent`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Sample errors |<p>The number of errors attempting to write time series, per second.</p> |DEPENDENT |cockroachdb.node.samples.errors<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `timeseries_write_errors`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Samples written |<p>The number of successfully written time series samples per second.</p> |DEPENDENT |cockroachdb.node.samples.written<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `timeseries_write_samples`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Sink byte traffic |<p>Bytes emitted by all feeds.</p> |DEPENDENT |cockroachdb.node.changefeed.sink_bytes<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `changefeed_emitted_bytes`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Slow DistSender RPCs |<p>Number of RPCs stuck or retrying for a long time</p> |DEPENDENT |cockroachdb.node.slow_requests.rpc<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `requests_slow_distsender`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: Slow latch acquisitions |<p>Number of requests that have been stuck for a long time acquiring latches.</p> |DEPENDENT |cockroachdb.node.slow_requests.latch_acquisitions<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `requests_slow_latch{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Slow lease acquisitions |<p>Number of requests that have been stuck for a long time acquiring a lease.</p> |DEPENDENT |cockroachdb.node.slow_requests.lease_acquisitions<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `requests_slow_lease{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Slow raft proposals |<p>Number of requests that have been stuck for a long time in raft.</p> |DEPENDENT |cockroachdb.node.slow_requests.raft_proposals<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `requests_slow_raft{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Generated snapshots |<p>Number of generated snapshots.</p> |DEPENDENT |cockroachdb.node.replication.snapshots.generated<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `range_snapshots_generated{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Applied snapshots (initial replication) |<p>Number of snapshots applied for initial upreplication.</p> |DEPENDENT |cockroachdb.node.replication.snapshots.initial<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `range_snapshots_applied_initial{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Applied snapshots (non-voters) |<p>Number of snapshots applied by non-voter replicas.</p> |DEPENDENT |cockroachdb.node.replication.snapshots.nonvoters<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `range_snapshots_applied_non_voter{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Applied snapshots (voters) |<p>Number of snapshots applied by voter replicas.</p> |DEPENDENT |cockroachdb.node.replication.snapshots.voters<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `range_snapshots_applied_voter{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Applied snapshots (voters) |<p>Number of snapshots applied by voter replicas.</p> |DEPENDENT |cockroachdb.node.replication.snapshots.voters<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `range_snapshots_applied_voter{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Split queue (pending actions) |<p>Number of pending replicas in the split queue.</p> |DEPENDENT |cockroachdb.node.queue.split.actions.pending<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_split_pending{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Split queue (successful actions) |<p>Number of replicas successfully processed by the split queue.</p> |DEPENDENT |cockroachdb.node.queue.split.actions.successful<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_split_process_success{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: SQL bytes received |<p>The total amount of incoming SQL client network traffic in bytes per second.</p> |DEPENDENT |cockroachdb.node.sql.bytes.received<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_bytesin`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: SQL bytes sent |<p>The total amount of outgoing SQL client network traffic in bytes per second.</p> |DEPENDENT |cockroachdb.node.sql.bytes.sent<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_bytesout`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: SQL memory |<p>The current amount of allocated SQL memory. This amount is what is compared against the node's --max-sql-memory flag.</p> |DEPENDENT |cockroachdb.node.sql.memory<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_mem_root_current`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: Schema changes |<p>The total number of DDL statements per second.</p> |DEPENDENT |cockroachdb.node.sql.schema.changes<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_ddl_count`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Open SQL sessions |<p>The total number of open SQL sessions.</p> |DEPENDENT |cockroachdb.node.sql.sessions<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_conns`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: Active SQL statements |<p>The total number of SQL statements currently running.</p> |DEPENDENT |cockroachdb.node.sql.statements.active<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_distsql_queries_active`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: SQL DELETE statements |<p>A moving average of the number of DELETE statements successfully executed per second.</p> |DEPENDENT |cockroachdb.node.sql.statements.delete<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_delete_count`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: SQL statements |<p>Number of SQL queries executed.</p> |DEPENDENT |cockroachdb.node.sql.statements<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_query_count`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Statement denials |<p>The total number of statements denied per second due to a cluster setting (https://www.cockroachlabs.com/docs/v21.1/cluster-settings.html) in the format feature.statement_type.enabled = FALSE.</p> |DEPENDENT |cockroachdb.node.sql.statements.denials<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_feature_flag_denial`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Active flows for distributed SQL statements |<p>The number of flows on the node contributing to currently running distributed SQL statements.</p> |DEPENDENT |cockroachdb.node.sql.statements.flows.active<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_distsql_flows_active`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: SQL INSERT statements |<p>A moving average of the number of INSERT statements successfully executed per second.</p> |DEPENDENT |cockroachdb.node.sql.statements.insert<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_insert_count`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: SQL SELECT statements |<p>A moving average of the number of SELECT statements successfully executed per second.</p> |DEPENDENT |cockroachdb.node.sql.statements.select<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_select_count`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: SQL UPDATE statements |<p>A moving average of the number of UPDATE statements successfully executed per second.</p> |DEPENDENT |cockroachdb.node.sql.statements.update<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_update_count`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: SQL statement contention |<p>The total number of SQL statements that experienced contention.</p> |DEPENDENT |cockroachdb.node.sql.statements.contention<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_distsql_contended_queries_count`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: SQL statement contention |<p>The total number of SQL statements that experienced contention.</p> |DEPENDENT |cockroachdb.node.sql.statements.contention<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_distsql_contended_queries_count`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: SQL statement errors |<p>The number of statements which returned a planning or runtime error.</p> |DEPENDENT |cockroachdb.node.sql.statements.errors<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_failure_count`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Open SQL transactions |<p>The total number of SQL transactions currently open.</p> |DEPENDENT |cockroachdb.node.sql.transactions.open<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_txns_open`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: SQL transactions aborted |<p>The total number of aborted SQL transactions per second.</p> |DEPENDENT |cockroachdb.node.sql.transactions.aborted<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_txn_abort_count`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: SQL transactions committed |<p>The total number of committed SQL transactions per second.</p> |DEPENDENT |cockroachdb.node.sql.transactions.committed<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_txn_commit_count`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: SQL transactions initiated |<p>The total number of initiated SQL transactions per second.</p> |DEPENDENT |cockroachdb.node.sql.transactions.initiated<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_txn_begin_count`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: SQL transactions rolled back |<p>The total number of rolled back SQL transactions per second.</p> |DEPENDENT |cockroachdb.node.sql.transactions.rollbacks<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_txn_rollback_count`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: SSTables |<p>The number of SSTables in use.</p> |DEPENDENT |cockroachdb.node.sstables<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `rocksdb_num_sstables{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Time series bytes written |<p>The number of bytes written by the time series system per second. Note that this does not reflect the rate at which disk space is consumed by time series; the data is highly compressed on disk. This rate is instead intended to indicate the amount of network traffic and disk activity generated by time series writes.</p> |DEPENDENT |cockroachdb.node.timeseries.bytes.written<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `timeseries_write_bytes`: `value`: ``</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Time series maintenance queue (pending actions) |<p>Number of pending replicas in the time series maintenance queue.</p> |DEPENDENT |cockroachdb.node.tsmaintenance.queue.actions.pending<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_tsmaintenance_pending{store=~".*"}`: `function`: `sum`</p> |
|CockroachDB node |CockroachDB node: Time series maintenance queue (successful actions) |<p>Number of replicas successfully processed by the time series maintenance queue.</p> |DEPENDENT |cockroachdb.node.tsmaintenance.queue.actions.successful<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `queue_tsmaintenance_process_success{store=~".*"}`: `function`: `sum`</p><p>- CHANGE_PER_SECOND</p> |
|CockroachDB node |CockroachDB node: Uptime |<p>Process uptime.</p> |DEPENDENT |cockroachdb.node.uptime<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sys_uptime`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: Disk capacity usage |<p>Disk space in use in percent.</p> |CALCULATED |cockroachdb.node.disk.capacity.usage<p>**Preprocessing**:</p><p>- MULTIPLIER: `100`</p><p>**Expression**:</p>`last(//cockroachdb.node.disk.capacity.used)/last(//cockroachdb.node.disk.capacity.available)` |
|CockroachDB node |CockroachDB node: KV execution latency bucket: {#LE} |<p>Latency of batch KV requests executed on this node.</p> |DEPENDENT |cockroachdb.node.kv.exec.latency.bucket[{#LE}]<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `exec_latency_bucket{le="{#LE}"}`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: KV execution latency, p90 |<p>The 90th percentile of latency between query requests and responses over a 5 minute period.</p> |CALCULATED |cockroachdb.node.kv.exec.latency.p90[{#SINGLETON}]<p>**Preprocessing**:</p><p>- MULTIPLIER: `0.000000001`</p><p>- STR_REPLACE: `-1E-09`: `0`</p><p>**Expression**:</p>`bucket_percentile(//cockroachdb.node.kv.exec.latency.bucket[*],5m,90)` |
|CockroachDB node |CockroachDB node: KV execution latency, p99 |<p>The 99th percentile of latency between query requests and responses over a 5 minute period.</p> |CALCULATED |cockroachdb.node.kv.exec.latency.p99[{#SINGLETON}]<p>**Preprocessing**:</p><p>- MULTIPLIER: `0.000000001`</p><p>- STR_REPLACE: `-1E-09`: `0`</p><p>**Expression**:</p>`bucket_percentile(//cockroachdb.node.kv.exec.latency.bucket[*],5m,99)` |
|CockroachDB node |CockroachDB node: Command commit latency bucket: {#LE} |<p>Raft commands commiting latency.</p> |DEPENDENT |cockroachdb.node.command.latency.bucket[{#LE}]<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `raft_process_commandcommit_latency_bucket{le="{#LE}"}`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: Command commit latency, p99 |<p>The 99th percentile of latency of Raft commands. This measures applying a batch to the storage engine (including writes to the write-ahead log), but no fsync.</p> |CALCULATED |cockroachdb.node.command.latency.p99[{#SINGLETON}]<p>**Preprocessing**:</p><p>- MULTIPLIER: `0.000000001`</p><p>- STR_REPLACE: `-1E-09`: `0`</p><p>**Expression**:</p>`bucket_percentile(//cockroachdb.node.command.latency.bucket[*],5m,99)` |
|CockroachDB node |CockroachDB node: Command commit latency, p50 |<p>The 50th percentile of latency of Raft commands. This measures applying a batch to the storage engine (including writes to the write-ahead log), but no fsync.</p> |CALCULATED |cockroachdb.node.command.latency.p50[{#SINGLETON}]<p>**Preprocessing**:</p><p>- MULTIPLIER: `0.000000001`</p><p>- STR_REPLACE: `-1E-09`: `0`</p><p>**Expression**:</p>`bucket_percentile(//cockroachdb.node.command.latency.bucket[*],5m,50)` |
|CockroachDB node |CockroachDB node: KV transactional durations bucket: {#LE} |<p>KV transaction durations.</p> |DEPENDENT |cockroachdb.node.kv.durations.latency.bucket[{#LE}]<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `txn_durations_bucket{le="{#LE}"}`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: KV transactional durations, p90 |<p>The 90th percentile of transaction durations over a 5 minute period.</p> |CALCULATED |cockroachdb.node.kv.durations.latency.p90[{#SINGLETON}]<p>**Preprocessing**:</p><p>- MULTIPLIER: `0.000000001`</p><p>- STR_REPLACE: `-1E-09`: `0`</p><p>**Expression**:</p>`bucket_percentile(//cockroachdb.node.kv.durations.latency.bucket[*],5m,90)` |
|CockroachDB node |CockroachDB node: KV transactional durations, p99 |<p>The 99th percentile of transaction durations over a 5 minute period.</p> |CALCULATED |cockroachdb.node.kv.durations.latency.p99[{#SINGLETON}]<p>**Preprocessing**:</p><p>- MULTIPLIER: `0.000000001`</p><p>- STR_REPLACE: `-1E-09`: `0`</p><p>**Expression**:</p>`bucket_percentile(//cockroachdb.node.kv.durations.latency.bucket[*],5m,99)` |
|CockroachDB node |CockroachDB node: Log commit latency bucket: {#LE} |<p>Latency of committing Raft log entries.</p> |DEPENDENT |cockroachdb.node.log.latency.bucket[{#LE}]<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `raft_process_logcommit_latency_bucket{le="{#LE}"}`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: Log commit latency, p50 |<p>The 50th percentile of latency for commits to the Raft Log. This measures essentially an fdatasync to the storage engines write-ahead log.</p> |CALCULATED |cockroachdb.node.log.latency.p50[{#SINGLETON}]<p>**Preprocessing**:</p><p>- MULTIPLIER: `0.000000001`</p><p>- STR_REPLACE: `-1E-09`: `0`</p><p>**Expression**:</p>`bucket_percentile(//cockroachdb.node.log.latency.bucket[*],5m,50)` |
|CockroachDB node |CockroachDB node: Log commit latency, p99 |<p>The 99th percentile of latency for commits to the Raft Log. This measures essentially an fdatasync to the storage engines write-ahead log.</p> |CALCULATED |cockroachdb.node.log.latency.p99[{#SINGLETON}]<p>**Preprocessing**:</p><p>- MULTIPLIER: `0.000000001`</p><p>- STR_REPLACE: `-1E-09`: `0`</p><p>**Expression**:</p>`bucket_percentile(//cockroachdb.node.log.latency.bucket[*],5m,99)` |
|CockroachDB node |CockroachDB node: Node heartbeat latency bucket: {#LE} |<p>Node liveness heartbeat latency.</p> |DEPENDENT |cockroachdb.node.heartbeat.latency.bucket[{#LE}]<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `liveness_heartbeatlatency_bucket{le="{#LE}"}`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: Node heartbeat latency, p90 |<p>The 90th percentile of latency to heartbeat a node's internal liveness record over a 5 minute period.</p> |CALCULATED |cockroachdb.node.heartbeat.latency.p90[{#SINGLETON}]<p>**Preprocessing**:</p><p>- MULTIPLIER: `0.000000001`</p><p>- STR_REPLACE: `-1E-09`: `0`</p><p>**Expression**:</p>`bucket_percentile(//cockroachdb.node.heartbeat.latency.bucket[*],5m,90)` |
|CockroachDB node |CockroachDB node: Node heartbeat latency, p99 |<p>The 99th percentile of latency to heartbeat a node's internal liveness record over a 5 minute period.</p> |CALCULATED |cockroachdb.node.heartbeat.latency.p99[{#SINGLETON}]<p>**Preprocessing**:</p><p>- MULTIPLIER: `0.000000001`</p><p>- STR_REPLACE: `-1E-09`: `0`</p><p>**Expression**:</p>`bucket_percentile(//cockroachdb.node.heartbeat.latency.bucket[*],5m,99)` |
|CockroachDB node |CockroachDB node: SQL service latency bucket: {#LE} |<p>Latency of SQL request execution.</p> |DEPENDENT |cockroachdb.node.sql.latency.bucket[{#LE}]<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_service_latency_bucket{le="{#LE}"}`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: SQL service latency, p90 |<p>Over the last 5 minutes, this node executed 90% of queries within this time. This time does not include network latency between the node and client.</p> |CALCULATED |cockroachdb.node.sql.latency.p90[{#SINGLETON}]<p>**Preprocessing**:</p><p>- MULTIPLIER: `0.000000001`</p><p>- STR_REPLACE: `-1E-09`: `0`</p><p>**Expression**:</p>`bucket_percentile(//cockroachdb.node.sql.latency.bucket[*],5m,90)` |
|CockroachDB node |CockroachDB node: SQL service latency, p99 |<p>Over the last 5 minutes, this node executed 99% of queries within this time. This time does not include network latency between the node and client.</p> |CALCULATED |cockroachdb.node.sql.latency.p99[{#SINGLETON}]<p>**Preprocessing**:</p><p>- MULTIPLIER: `0.000000001`</p><p>- STR_REPLACE: `-1E-09`: `0`</p><p>**Expression**:</p>`bucket_percentile(//cockroachdb.node.sql.latency.bucket[*],5m,99)` |
|CockroachDB node |CockroachDB node: Transaction latency bucket: {#LE} |<p>Latency of SQL transactions.</p> |DEPENDENT |cockroachdb.node.transaction.latency.bucket[{#LE}]<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `sql_txn_latency_bucket{le="{#LE}"}`: `value`: ``</p> |
|CockroachDB node |CockroachDB node: Transaction latency, p90 |<p>The 90th percentile of total transaction time over a 5 minute period.</p> |CALCULATED |cockroachdb.node.transaction.latency.p90[{#SINGLETON}]<p>**Preprocessing**:</p><p>- MULTIPLIER: `0.000000001`</p><p>- STR_REPLACE: `-1E-09`: `0`</p><p>**Expression**:</p>`bucket_percentile(//cockroachdb.node.transaction.latency.bucket[*],5m,90)` |
|CockroachDB node |CockroachDB node: Transaction latency, p99 |<p>The 99th percentile of total transaction time over a 5 minute period.</p> |CALCULATED |cockroachdb.node.transaction.latency.p99[{#SINGLETON}]<p>**Preprocessing**:</p><p>- MULTIPLIER: `0.000000001`</p><p>- STR_REPLACE: `-1E-09`: `0`</p><p>**Expression**:</p>`bucket_percentile(//cockroachdb.node.transaction.latency.bucket[*],5m,99)` |
|CockroachDB node |CockroachDB node: {#DESC} certificate expiration date |<p>{#DESC} certificate expires at that date.</p> |DEPENDENT |cockroachdb.node.cert.expire_date[{#TYPE}]<p>**Preprocessing**:</p><p>- PROMETHEUS_PATTERN: `{#NAME}`: `value`: ``</p> |
|Zabbix raw items |CockroachDB node: Get node metrics |<p>Get raw metrics from the Prometheus endpoint.</p> |HTTP_AGENT |cockroachdb.node.get_metrics |
|Zabbix raw items |CockroachDB node: Get node health endpoint |<p>Get node /health endpoint</p> |HTTP_AGENT |cockroachdb.node.get_health<p>**Preprocessing**:</p><p>- JAVASCRIPT: `if (!Object.keys(JSON.parse(value)).length){     return 1; } else return 0; `</p> |
|Zabbix raw items |CockroachDB node: Get node readiness |<p>Get node /health?ready=1 endpoint</p> |HTTP_AGENT |cockroachdb.node.get_readiness<p>**Preprocessing**:</p><p>- JAVASCRIPT: `if (!Object.keys(JSON.parse(value)).length){     return 1; } else return 0; `</p> |

## Triggers

|Name|Description|Expression|Severity|Dependencies and additional info|
|----|-----------|----|----|----|
|CockroachDB node: Service is down |<p>-</p> |`last(/CockroachDB node by HTTP/net.tcp.service["{$COCKROACHDB.API.SCHEME}","{HOST.CONN}","{$COCKROACHDB.API.PORT}"])=0` |AVERAGE | |
|CockroachDB node: Version has changed |<p>-</p> |`last(/CockroachDB node by HTTP/cockroachdb.node.version)<>last(/CockroachDB node by HTTP/cockroachdb.node.version,#2) and length(last(/CockroachDB node by HTTP/cockroachdb.node.version))>0` |INFO | |
|CockroachDB node: Node is not executing SQL |<p>Node is not executing SQL despite having connections.</p> |`last(/CockroachDB node by HTTP/cockroachdb.node.sql.sessions)>0 and last(/CockroachDB node by HTTP/cockroachdb.node.sql.statements)=0` |WARNING | |
|CockroachDB node: Node has been restarted |<p>Uptime is less than 10 minutes.</p> |`last(/CockroachDB node by HTTP/cockroachdb.node.uptime)<10m` |INFO | |
|CockroachDB node: Disk capacity usage has reached threshold |<p>Node is running low on free space available (used more than {$COCKROACHDB.DISK.USED.WARN}%)</p> |`last(/CockroachDB node by HTTP/cockroachdb.node.disk.capacity.usage)>{$COCKROACHDB.DISK.USED.WARN}` |WARNING | |
|CockroachDB node: {#DESC} certificate expires soon |<p>{#DESC} certificate expires soon.</p> |`(last(/CockroachDB node by HTTP/cockroachdb.node.cert.expire_date[{#TYPE}]) - now()) / 86400 < {$COCKROACHDB.CERT.EXPIRY.WARN}` |WARNING | |
|CockroachDB node: Failed to fetch node data |<p>Zabbix has not received data for items for the last 5 minutes.</p> |`nodata(/CockroachDB node by HTTP/cockroachdb.node.get_metrics,5m)=1` |AVERAGE |<p>**Depends on**:</p><p>- CockroachDB node: Service is down</p> |
|CockroachDB node: Failed to fetch node health data |<p>Zabbix has not received /health endpoint data for the last 5 minutes.</p> |`nodata(/CockroachDB node by HTTP/cockroachdb.node.get_health,5m)=1` |AVERAGE |<p>**Depends on**:</p><p>- CockroachDB node: Service is down</p> |
|CockroachDB node: Node is unhealthy |<p>Node's /health endpoint has returned the result which is not empty.</p> |`last(/CockroachDB node by HTTP/cockroachdb.node.get_health)=0` |AVERAGE |<p>**Depends on**:</p><p>- CockroachDB node: Service is down</p> |
|CockroachDB node: Failed to fetch node readiness data |<p>Zabbix has not received /health?ready=1 endpoint data for the last 5 minutes.</p> |`nodata(/CockroachDB node by HTTP/cockroachdb.node.get_readiness,5m)=1` |AVERAGE |<p>**Depends on**:</p><p>- CockroachDB node: Service is down</p> |
|CockroachDB node: Node is not ready |<p>Node's /health?ready=1 endpoint has returned the result which is not empty.</p> |`last(/CockroachDB node by HTTP/cockroachdb.node.get_readiness)=0` |AVERAGE |<p>**Depends on**:</p><p>- CockroachDB node: Service is down</p> |

## Feedback

Please report any issues with the template at https://support.zabbix.com

You can also provide feedback, discuss the template or ask for help with it at [ZABBIX forums](https://www.zabbix.com/forum/zabbix-suggestions-and-feedback).

