
# Template DB MSSQL by ODBC

## Overview

For Zabbix version: 5.0  
The template is developed for monitoring DBMS Microsoft SQL Server via ODBC.

This template was tested on:

- Zabbix, version 4.4
- Microsoft SQL, version 2017

## Setup

1.Create MSSQL user for monitoring.
For more information read the MSSQL documentation, please. 
2.Set the user name and password in host macros ({$MSSQL.USER} and {$MSSQL.PASSWORD}).


## Zabbix configuration

No specific Zabbix configuration is required.

### Macros used

|Name|Description|Default|
|----|-----------|-------|
|{$MSSQL.BUFFER_CACHE_RATIO.MIN.CRIT} |<p>The % buffer cache hit ratio for high trigger expression.</p> |`30` |
|{$MSSQL.BUFFER_CACHE_RATIO.MIN.WARN} |<p>The % buffer cache hit ratio for warning trigger expression.</p> |`50` |
|{$MSSQL.DBNAME.MATCHES} |<p>This macro is used in database discovery. It can be overridden on the host or linked template level.</p> |`.*` |
|{$MSSQL.DBNAME.NOT_MATCHES} |<p>This macro is used in database discovery. It can be overridden on the host or linked template level.</p> |`master|tempdb|model|msdb` |
|{$MSSQL.DSN} |<p>System data source name.</p> |`<Put your DSN here>` |
|{$MSSQL.HOST} |<p>MSSQL host IP address or FQDN.</p> |`localhost` |
|{$MSSQL.PASSWORD} |<p>MSSQL user password.</p> |`<Put your password here>` |
|{$MSSQL.PORT} |<p>MSSQL tcp port.</p> |`1433` |
|{$MSSQL.USER} |<p>MSSQL username.</p> |`<Put your username here>` |
|{$MSSQL.WORK_FILES.MAX} |<p>The number of work files created per second for trigger expression.</p> |`300` |
|{$MSSQL.WORK_TABLES.MAX} |<p>The number of work tables created per second for trigger expression.</p> |`50` |

## Template links

There are no template links in this template.

## Discovery rules

|Name|Description|Type|Key and additional info|
|----|-----------|----|----|
|Database discovery |<p>Scanning databases in DBMS.</p> |ODBC |db.odbc.discovery[dbname,{$MSSQL.DSN}]<p>**Preprocessing**:</p><p>- DISCARD_UNCHANGED_HEARTBEAT: `1d`</p><p>**Filter**:</p>AND <p>- A: {#DBNAME} MATCHES_REGEX `{$MSSQL.DBNAME.MATCHES}`</p><p>- B: {#DBNAME} NOT_MATCHES_REGEX `{$MSSQL.DBNAME.NOT_MATCHES}`</p> |

## Items collected

|Group|Name|Description|Type|Key and additional info|
|-----|----|-----------|----|---------------------|
|MSSQL |MSSQL: Version | |ODBC |db.odbc.select[version,{$MSSQL.DSN}]<p>**Preprocessing**:</p><p>- DISCARD_UNCHANGED_HEARTBEAT: `1d`</p><p>**Expression**:</p>`SELECT @@VERSION;` |
|MSSQL |Port Availability |<p>Test the availability of MS SQL Server on TCP port.</p> |SIMPLE |net.tcp.service[tcp,{$MSSQL.HOST},{$MSSQL.PORT}]<p>**Preprocessing**:</p><p>- DISCARD_UNCHANGED_HEARTBEAT: `10m`</p> |
|MSSQL |MSSQL: Forwarded Records/sec |<p>Number of records per second fetched through forwarded record pointers.</p> |DEPENDENT |mssql.forwarded_records_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Access Methods' && @.counter_name=='Forwarded Records/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Full Scans/sec |<p>Number of unrestricted full scans per second. These can be either</p><p>base-table or full-index scans.</p> |DEPENDENT |mssql.full_scans_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Access Methods' && @.counter_name=='Full Scans/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Index Searches/sec |<p>Number of index searches per second. These are used to start a range</p><p>scan, reposition a range scan, revalidate a scan point, fetch a single index</p><p>record, and search down the index to locate where to insert a new row.</p> |DEPENDENT |mssql.index_searches_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Access Methods' && @.counter_name=='Index Searches/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Page Splits/sec |<p>Number of page splits per second that occur as the result of overflowing</p><p>index pages.</p> |DEPENDENT |mssql.page_splits_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Access Methods' && @.counter_name=='Page Splits/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Work files created/sec |<p>Number of work files created per second. For example, work files</p><p>could be used to store temporary results for hash joins and hash aggregates.</p> |DEPENDENT |mssql.workfiles_created_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Access Methods' && @.counter_name=='Workfiles Created/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Work tables created/sec |<p>Number of work tables created per second. For example, work tables</p><p>could be used to store temporary results for query spool, lob variables, XML</p><p>variables, and cursors.</p> |DEPENDENT |mssql.worktables_created_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Access Methods' && @.counter_name=='Worktables Created/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: % Buffer cache hit ratio |<p>Indicates the percentage of pages found in the buffer cache without</p><p>having to read from disk. The ratio is the total number of cache hits divided</p><p>by the total number of cache lookups over the last few thousand page accesses.</p><p>After a long period of time, the ratio moves very little. Because reading from</p><p>the cache is much less expensive than reading from disk, you want this ratio</p><p>to be high. Generally, you can increase the buffer cache hit ratio by increasing</p><p>the amount of memory available to SQL Server or by using the buffer pool extension</p><p>feature.</p> |DEPENDENT |mssql.buffer_cache_hit_ratio<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Buffer Manager' && @.counter_name=='Buffer cache hit ratio')].cntr_value.first()`</p> |
|MSSQL |MSSQL: Checkpoint pages/sec |<p>Indicates the number of pages flushed to disk per second by a checkpoint</p><p>or other operation that require all dirty pages to be flushed.</p> |DEPENDENT |mssql.checkpoint_pages_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Buffer Manager' && @.counter_name=='Checkpoint pages/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Database pages |<p>Indicates the number of pages in the buffer pool with database content.</p> |DEPENDENT |mssql.database_pages<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Buffer Manager' && @.counter_name=='Database pages')].cntr_value.first()`</p> |
|MSSQL |MSSQL: Free list stalls/sec |<p>Indicates the number of requests per second that had to wait for a free page.</p> |DEPENDENT |mssql.free_list_stalls_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Buffer Manager' && @.counter_name=='Free list stalls/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Lazy writes/sec |<p>Indicates the number of buffers written per second by the buffer</p><p>manager's lazy writer. The lazy writer is a system process that flushes out</p><p>batches of dirty, aged buffers (buffers that contain changes that must be written</p><p>back to disk before the buffer can be reused for a different page) and makes</p><p>them available to user processes. The lazy writer eliminates the need to perform</p><p>frequent checkpoints in order to create available buffers.</p> |DEPENDENT |mssql.lazy_writes_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Buffer Manager' && @.counter_name=='Lazy writes/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Page life expectancy |<p>Indicates the number of seconds a page will stay in the buffer pool</p><p>without references.</p> |DEPENDENT |mssql.page_life_expectancy<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Buffer Manager' && @.counter_name=='Page life expectancy')].cntr_value.first()`</p><p>- MULTIPLIER: `0.01667`</p> |
|MSSQL |MSSQL: Page lookups/sec |<p>Indicates the number of requests per second to find a page in the</p><p>buffer pool.</p> |DEPENDENT |mssql.page_lookups_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Buffer Manager' && @.counter_name=='Page lookups/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Page reads/sec |<p>Indicates the number of physical database page reads that are issued</p><p>per second. This statistic displays the total number of physical page reads</p><p>across all databases. Because physical I/O is expensive, you may be able to</p><p>minimize the cost, either by using a larger data cache, intelligent indexes,</p><p>and more efficient queries, or by changing the database design.</p> |DEPENDENT |mssql.page_reads_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Buffer Manager' && @.counter_name=='Page reads/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Page writes/sec |<p>Indicates the number of physical database page writes that are issued per second.</p> |DEPENDENT |mssql.page_writes_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Buffer Manager' && @.counter_name=='Page writes/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Read-ahead pages/sec |<p>Indicates the number of pages read per second in anticipation of use.</p> |DEPENDENT |mssql.readahead_pages_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Buffer Manager' && @.counter_name=='Readahead pages/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Target pages |<p>The optimum number of pages in the buffer pool.</p> |DEPENDENT |mssql.target_pages<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Buffer Manager' && @.counter_name=='Target pages')].cntr_value.first()`</p> |
|MSSQL |MSSQL: Data File Size (Total) |<p>Total size (in kilobytes) of all the data files.</p> |DEPENDENT |mssql.data_files_size<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Databases' && @.counter_name=='Data File(s) Size (KB)' && @.instance_name=='_Total')].cntr_value.first()`</p> |
|MSSQL |MSSQL: Log File Size (Total) |<p>Total size (in kilobytes) of all the transaction log files.</p> |DEPENDENT |mssql.log_files_size<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Databases' && @.counter_name=='Log File(s) Size (KB)' && @.instance_name=='_Total')].cntr_value.first()`</p> |
|MSSQL |MSSQL: Log File Used Size (Total) |<p>The cumulative used size of all the log files in the database.</p> |DEPENDENT |mssql.log_files_used_size<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Databases' && @.counter_name=='Log File(s) Used Size (KB)' && @.instance_name=='_Total')].cntr_value.first()`</p> |
|MSSQL |MSSQL: Transactions/sec (Total) |<p>Total number of transactions started for all databases per second.</p> |DEPENDENT |mssql.transactions_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Databases' && @.counter_name=='Transactions/sec' && @.instance_name=='_Total')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Logins/sec |<p>Total number of logins started per second. This does not include</p><p>pooled connections.</p> |DEPENDENT |mssql.logins_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:General Statistics' && @.counter_name=='Logins/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Logouts/sec |<p>Total number of logout operations started per second.</p> |DEPENDENT |mssql.logouts_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:General Statistics' && @.counter_name=='Logouts/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Number of Blocked Processes |<p>Number of currently blocked processes.</p> |DEPENDENT |mssql.processes_blocked<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:General Statistics' && @.counter_name=='Processes blocked')].cntr_value.first()`</p> |
|MSSQL |MSSQL: Number Users Connected |<p>Number of users connected to MS SQL Server.</p> |DEPENDENT |mssql.user_connections<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:General Statistics' && @.counter_name=='User Connections')].cntr_value.first()`</p> |
|MSSQL |MSSQL: Average Latch Wait Time |<p>Average latch wait time (in milliseconds) for latch requests that</p><p>had to wait.</p> |DEPENDENT |mssql.average_latch_wait_time<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Latches' && @.counter_name=='Average Latch Wait Time (ms)')].cntr_value.first()`</p> |
|MSSQL |MSSQL: Latch Waits/sec |<p>Number of latch requests that could not be granted immediately.</p> |DEPENDENT |mssql.latch_waits_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Latches' && @.counter_name=='Latch Waits/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Total Latch Wait Time |<p>Total latch wait time (in milliseconds) for latch requests in the</p><p>last second.</p> |DEPENDENT |mssql.total_latch_wait_time<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Latches' && @.counter_name=='Total Latch Wait Time (ms)')].cntr_value.first()`</p> |
|MSSQL |MSSQL: Average Wait Time (Total) |<p>Total wait time (in milliseconds) for locks in the last second.</p> |DEPENDENT |mssql.average_wait_time<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Locks' && @.counter_name=='Average Wait Time (ms)' && @.instance_name=='_Total')].cntr_value.first()`</p> |
|MSSQL |MSSQL: Lock Requests/sec (Total) |<p>Number of new locks and lock conversions per second requested from</p><p>the lock manager.</p> |DEPENDENT |mssql.lock_requests_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Locks' && @.counter_name=='Lock Requests/sec' && @.instance_name=='_Total')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Lock Timeouts/sec (Total) |<p>Number of lock requests per second that timed out, including requests</p><p>for NOWAIT locks.</p> |DEPENDENT |mssql.lock_timeouts_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Locks' && @.counter_name=='Lock Timeouts/sec' && @.instance_name=='_Total')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Lock Waits/sec (Total) |<p>Number of lock requests per second that required the caller to wait.</p> |DEPENDENT |mssql.lock_waits_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Locks' && @.counter_name=='Lock Waits/sec' && @.instance_name=='_Total')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Lock Wait Time (Total) |<p>Average amount of wait time (in milliseconds) for each lock request</p><p>that resulted in a wait.</p> |DEPENDENT |mssql.lock_wait_time<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Locks' && @.counter_name=='Lock Wait Time (ms)' && @.instance_name=='_Total')].cntr_value.first()`</p> |
|MSSQL |MSSQL: Number of Deadlocks/sec (Total) |<p>Number of lock requests per second that resulted in a deadlock.</p> |DEPENDENT |mssql.number_deadlocks_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Locks' && @.counter_name=='Number of Deadlocks/sec' && @.instance_name=='_Total')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Granted Workspace Memory |<p>Specifies the total amount of memory currently granted to executing</p><p>processes, such as hash, sort, bulk copy, and index creation operations.</p> |DEPENDENT |mssql.granted_workspace_memory<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Memory Manager' && @.counter_name=='Granted Workspace Memory (KB)')].cntr_value.first()`</p><p>- MULTIPLIER: `1024`</p> |
|MSSQL |MSSQL: Maximum Workspace Memory |<p>Indicates the maximum amount of memory available for executing processes,</p><p>such as hash, sort, bulk copy, and index creation operations.</p> |DEPENDENT |mssql.maximum_workspace_memory<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Memory Manager' && @.counter_name=='Maximum Workspace Memory (KB)')].cntr_value.first()`</p><p>- MULTIPLIER: `1024`</p> |
|MSSQL |MSSQL: Memory Grants Outstanding |<p>Specifies the total number of processes that have successfully acquired</p><p>a workspace memory grant.</p> |DEPENDENT |mssql.memory_grants_outstanding<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Memory Manager' && @.counter_name=='Memory Grants Outstanding')].cntr_value.first()`</p> |
|MSSQL |MSSQL: Memory Grants Pending |<p>Specifies the total number of processes waiting for a workspace</p><p>memory grant.</p> |DEPENDENT |mssql.memory_grants_pending<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Memory Manager' && @.counter_name=='Memory Grants Pending')].cntr_value.first()`</p> |
|MSSQL |MSSQL: Target Server Memory |<p>Indicates the ideal amount of memory the server can consume.</p> |DEPENDENT |mssql.target_server_memory<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Memory Manager' && @.counter_name=='Target Server Memory (KB)')].cntr_value.first()`</p><p>- MULTIPLIER: `1024`</p> |
|MSSQL |MSSQL: Total Server Memory |<p>Specifies the amount of memory the server has committed using the</p><p>memory manager.</p> |DEPENDENT |mssql.total_server_memory<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Memory Manager' && @.counter_name=='Total Server Memory (KB)')].cntr_value.first()`</p><p>- MULTIPLIER: `1024`</p> |
|MSSQL |MSSQL: Cache Hit Ratio |<p>Ratio between cache hits and lookups.</p> |DEPENDENT |mssql.cache_hit_ratio<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Plan Cache' && @.counter_name=='Cache Hit Ratio' && @.instance_name=='_Total')].cntr_value.first()`</p> |
|MSSQL |MSSQL: Cache Object Counts |<p>Number of cache objects in the cache.</p> |DEPENDENT |mssql.cache_object_counts<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Plan Cache' && @.counter_name=='Cache Object Counts' && @.instance_name=='_Total')].cntr_value.first()`</p> |
|MSSQL |MSSQL: Cache Objects in use |<p>Number of cache objects in use.</p> |DEPENDENT |mssql.cache_objects_in_use<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Plan Cache' && @.counter_name=='Cache Objects in use' && @.instance_name=='_Total')].cntr_value.first()`</p> |
|MSSQL |MSSQL: Cache Pages |<p>Number of 8-kilobyte (KB) pages used by cache objects.</p> |DEPENDENT |mssql.cache_pages<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Plan Cache' && @.counter_name=='Cache Pages' && @.instance_name=='_Total')].cntr_value.first()`</p> |
|MSSQL |MSSQL: Errors/sec (DB Offline Errors) |<p>Number of errors per second.</p> |DEPENDENT |mssql.offline_errors_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:SQL Errors' && @.counter_name=='Errors/sec' && @.instance_name=='DB Offline Errors')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Errors/sec (Info Errors) |<p>Number of errors/sec.</p> |DEPENDENT |mssql.info_errors_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:SQL Errors' && @.counter_name=='Errors/sec' && @.instance_name=='Info Errors')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Errors/sec (Kill Connection Errors) |<p>Number of errors/sec.</p> |DEPENDENT |mssql.kill_connection_errors_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:SQL Errors' && @.counter_name=='Errors/sec' && @.instance_name=='Kill Connection Errors')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Errors/sec (User Errors) |<p>Number of errors/sec.</p> |DEPENDENT |mssql.user_errors_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:SQL Errors' && @.counter_name=='Errors/sec' && @.instance_name=='User Errors')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Errors/sec (Total) |<p>Number of errors/sec.</p> |DEPENDENT |mssql.errors_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:SQL Errors' && @.counter_name=='Errors/sec' && @.instance_name=='_Total')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Auto-Param Attempts/sec |<p>Number of auto-parameterization attempts per second. Total should</p><p>be the sum of the failed, safe, and unsafe auto-parameterizations. Auto-parameterization</p><p>occurs when an instance of SQL Server tries to parameterize a Transact-SQL request</p><p>by replacing some literals with parameters so that reuse of the resulting cached</p><p>execution plan across multiple similar-looking requests is possible. Note that</p><p>auto-parameterizations are also known as simple parameterizations in newer versions</p><p>of SQL Server. This counter does not include forced parameterizations.</p> |DEPENDENT |mssql.autoparam_attempts_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:SQL Statistics' && @.counter_name=='Auto-Param Attempts/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Batch Requests/Sec |<p>Number of Transact-SQL command batches received per second. This</p><p>statistic is affected by all constraints (such as I/O, number of users, cache</p><p>size, complexity of requests, and so on). High batch requests mean good throughput.</p> |DEPENDENT |mssql.batch_requests_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:SQL Statistics' && @.counter_name=='Batch Requests/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Failed Auto-Params/sec |<p>Number of failed auto-parameterization attempts per second. This</p><p>should be small. Note that auto-parameterizations are also known as simple parameterizations</p><p>in later versions of SQL Server.</p> |DEPENDENT |mssql.failed_autoparams_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:SQL Statistics' && @.counter_name=='Failed Auto-Params/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Safe Auto-Params/sec |<p>Number of safe auto-parameterization attempts per second. Safe refers</p><p>to a determination that a cached execution plan can be shared between different</p><p>similar-looking Transact-SQL statements. SQL Server makes many auto-parameterization</p><p>attempts some of which turn out to be safe and others fail. Note that auto-parameterizations</p><p>are also known as simple parameterizations in later versions of SQL Server.</p><p>This does not include forced parameterizations.</p> |DEPENDENT |mssql.safe_autoparams_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:SQL Statistics' && @.counter_name=='Safe Auto-Params/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: SQL Compilations/Sec |<p>Number of SQL compilations per second. Indicates the number of times</p><p>the compile code path is entered. Includes compiles caused by statement-level</p><p>recompilations in SQL Server. After SQL Server user activity is stable, this</p><p>value reaches a steady state.</p> |DEPENDENT |mssql.sql_compilations_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:SQL Statistics' && @.counter_name=='SQL Compilations/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: SQL Re-Compilations/sec |<p>Number of statement recompiles per second. Counts the number of</p><p>times statement recompiles are triggered. Generally, you want the recompiles</p><p>to be low.</p> |DEPENDENT |mssql.sql_recompilations_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:SQL Statistics' && @.counter_name=='SQL Re-Compilations/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Unsafe Auto-Params/sec |<p>Number of unsafe auto-parameterization attempts per second. For</p><p>example, the query has some characteristics that prevent the cached plan from</p><p>being shared. These are designated as unsafe. This does not count the number</p><p>of forced parameterizations.</p> |DEPENDENT |mssql.unsafe_autoparams_sec<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:SQL Statistics' && @.counter_name=='Unsafe Auto-Params/sec')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: Transactions Number (Total) |<p>The number of currently active transactions of all types.</p> |DEPENDENT |mssql.transactions<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Transactions' && @.counter_name=='Transactions')].cntr_value.first()`</p> |
|MSSQL |MSSQL: {#DBNAME} status |<p>32 = loading</p><p>128 = recovering</p><p>256 = not recovered</p><p>512 = offline (ALTER DATABASE)</p><p>32768 = emergency mode</p> |ODBC |db.odbc.select[{#DBNAME}_status,{$MSSQL.DSN}]<p>**Expression**:</p>`select coalesce(max(status),999) from master..sysdatabases where name = '{#DBNAME}'` |
|MSSQL |MSSQL: {#DBNAME} Active Transactions |<p>Number of active transactions for the database.</p> |DEPENDENT |mssql.active_transactions[{#DBNAME}]<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Databases' && @.counter_name=='Active Transactions' && @.instance_name=='{#DBNAME}')].cntr_value.first()`</p> |
|MSSQL |MSSQL: {#DBNAME} Data File Size |<p>Cumulative size (in kilobytes) of all the data files in the database</p><p>including any automatic growth. Monitoring this counter is useful, for example,</p><p>for determining the correct size of tempdb.</p> |DEPENDENT |mssql.data_files_size[{#DBNAME}]<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Databases' && @.counter_name=='Data File(s) Size (KB)' && @.instance_name=='{#DBNAME}')].cntr_value.first()`</p><p>- MULTIPLIER: `1024`</p> |
|MSSQL |MSSQL: {#DBNAME} Log Bytes Flushed/sec |<p>Total number of log bytes flushed per second. Useful for determining</p><p>trends and utilization of the transaction log.</p> |DEPENDENT |mssql.log_bytes_flushed_sec[{#DBNAME}]<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Databases' && @.counter_name=='Log Bytes Flushed/sec' && @.instance_name=='{#DBNAME}')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: {#DBNAME} Log File Size |<p>Cumulative size (in kilobytes) of all the transaction log files</p><p>in the database.</p> |DEPENDENT |mssql.log_files_size[{#DBNAME}]<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Databases' && @.counter_name=='Log File(s) Size (KB)' && @.instance_name=='{#DBNAME}')].cntr_value.first()`</p><p>- MULTIPLIER: `1024`</p> |
|MSSQL |MSSQL: {#DBNAME} Log File Used Size |<p>The cumulative used size of all the log files in the database.</p> |DEPENDENT |mssql.log_files_used_size[{#DBNAME}]<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Databases' && @.counter_name=='Log File(s) Used Size (KB)' && @.instance_name=='{#DBNAME}')].cntr_value.first()`</p><p>- MULTIPLIER: `1024`</p> |
|MSSQL |MSSQL: {#DBNAME} Log Flushes/sec |<p>Number of log flushes per second.</p> |DEPENDENT |mssql.log_flushes_sec[{#DBNAME}]<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Databases' && @.counter_name=='Log Flushes/sec' && @.instance_name=='{#DBNAME}')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: {#DBNAME} Log Flush Waits/sec |<p>Number of commits per second waiting for the log flush.</p> |DEPENDENT |mssql.log_flush_waits_sec[{#DBNAME}]<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Databases' && @.counter_name=='Log Flush Waits/sec' && @.instance_name=='{#DBNAME}')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|MSSQL |MSSQL: {#DBNAME} Log Flush Wait Time |<p>Total wait time (in milliseconds) to flush the log. On an AlwaysOn</p><p>secondary database, this value indicates the wait time for log records to</p><p>be hardened to disk.</p> |DEPENDENT |mssql.log_flush_wait_time[{#DBNAME}]<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Databases' && @.counter_name=='Log Flush Wait Time' && @.instance_name=='{#DBNAME}')].cntr_value.first()`</p> |
|MSSQL |MSSQL: {#DBNAME} Log Growths |<p>Total number of times the transaction log for the database has</p><p>been expanded.</p> |DEPENDENT |mssql.log_growths[{#DBNAME}]<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Databases' && @.counter_name=='Log Growths' && @.instance_name=='{#DBNAME}')].cntr_value.first()`</p><p>- SIMPLE_CHANGE |
|MSSQL |MSSQL: {#DBNAME} Log Shrinks |<p>Total number of times the transaction log for the database has</p><p>been shrunk.</p> |DEPENDENT |mssql.log_shrinks[{#DBNAME}]<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Databases' && @.counter_name=='Log Shrinks' && @.instance_name=='{#DBNAME}')].cntr_value.first()`</p> |
|MSSQL |MSSQL: {#DBNAME} Log Truncations |<p>The number of times the transaction log has been shrunk.</p> |DEPENDENT |mssql.log_truncations[{#DBNAME}]<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Databases' && @.counter_name=='Log Truncations' && @.instance_name=='{#DBNAME}')].cntr_value.first()`</p> |
|MSSQL |MSSQL: {#DBNAME} Percent Log Used |<p>Percentage of space in the log that is in use.</p> |DEPENDENT |mssql.percent_log_used[{#DBNAME}]<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Databases' && @.counter_name=='Percent Log Used' && @.instance_name=='{#DBNAME}')].cntr_value.first()`</p> |
|MSSQL |MSSQL: {#DBNAME} Transactions/sec |<p>Number of transactions started for the database per second.</p> |DEPENDENT |mssql.transactions_sec[{#DBNAME}]<p>**Preprocessing**:</p><p>- JSONPATH: `$[?(@.object_name=='SQLServer:Databases' && @.counter_name=='Transactions/sec' && @.instance_name=='{#DBNAME}')].cntr_value.first()`</p><p>- CHANGE_PER_SECOND |
|Zabbix_raw_items |MSSQL: Get performance counters |<p>The item gets server global status information.</p> |ODBC |db.odbc.get[get_status_variables,"{$MSSQL.DSN}"]<p>**Expression**:</p>`SELECT object_name, counter_name, instance_name, cntr_value FROM master.sys.dm_os_performance_counters` |

## Triggers

|Name|Description|Expression|Severity|Dependencies and additional info|
|----|-----------|----|----|----|
|MSSQL: Version has changed (new version value received: {ITEM.VALUE}) |<p>MSSQL version has changed. Ack to close.</p> |`{TEMPLATE_NAME:db.odbc.select[version,{$MSSQL.DSN}].diff()}=1 and {TEMPLATE_NAME:db.odbc.select[version,{$MSSQL.DSN}].strlen()}>0` |INFO |<p>Manual close: YES</p> |
|Server port is unavailable | |`{TEMPLATE_NAME:net.tcp.service[tcp,{$MSSQL.HOST},{$MSSQL.PORT}].max(#3)}=0` |DISASTER | |
|MSSQL: Number work files created/sec is over {$MSSQL.WORK_FILES.MAX} for 5m |<p>Too many work files created per second to store temporary results for hash joins and hash aggregates.</p> |`{TEMPLATE_NAME:mssql.workfiles_created_sec.min(5m)}>{$MSSQL.WORK_FILES.MAX}` |AVERAGE | |
|MSSQL: Number work tables created/sec is over {$MSSQL.WORK_TABLES.MAX} for 5m |<p>Too many work tables created per second to store temporary results for query spool, lob variables, XML variables, and cursors.</p> |`{TEMPLATE_NAME:mssql.worktables_created_sec.min(5m)}>{$MSSQL.WORK_TABLES.MAX}` |AVERAGE | |
|MSSQL: Buffer cache hit ratio is below {$MSSQL.BUFFER_CACHE_RATIO.MIN.CRIT} for 5m |<p>Too low buffer cache hit ratio.</p> |`{TEMPLATE_NAME:mssql.buffer_cache_hit_ratio.max(5m)}<{$MSSQL.BUFFER_CACHE_RATIO.MIN.CRIT}` |HIGH | |
|MSSQL: Buffer cache hit ratio is below {$MSSQL.BUFFER_CACHE_RATIO.MIN.WARN} for 5m |<p>Low buffer cache hit ratio.</p> |`{TEMPLATE_NAME:mssql.buffer_cache_hit_ratio.max(5m)}<{$MSSQL.BUFFER_CACHE_RATIO.MIN.WARN}` |WARNING |<p>**Depends on**:</p><p>- MSSQL: Buffer cache hit ratio is below {$MSSQL.BUFFER_CACHE_RATIO.MIN.CRIT} for 5m</p> |
|MSSQL: Free list stalls/sec | |`{TEMPLATE_NAME:mssql.free_list_stalls_sec.min(5m)}>2` |WARNING | |
|MSSQL: Lazy writes/sec | |`{TEMPLATE_NAME:mssql.lazy_writes_sec.min(5m)}>20` |WARNING | |
|MSSQL: Page life expectancy | |`{TEMPLATE_NAME:mssql.page_life_expectancy.max(5m)}<5` |HIGH | |
|MSSQL: Page reads/sec | |`{TEMPLATE_NAME:mssql.page_reads_sec.min(5m)}>90` |WARNING | |
|MSSQL: Page writes/sec | |`{TEMPLATE_NAME:mssql.page_writes_sec.min(5m)}>90` |WARNING | |
|MSSQL: Average Wait Time (Total) | |`{TEMPLATE_NAME:mssql.average_wait_time.min(5m)}>500` |WARNING | |
|MSSQL: Lock Requests/sec (Total) | |`{TEMPLATE_NAME:mssql.lock_requests_sec.min(5m)}>3000` |WARNING | |
|MSSQL: Lock Timeouts/sec (Total) | |`{TEMPLATE_NAME:mssql.lock_timeouts_sec.min(5m)}>1` |WARNING | |
|MSSQL: Deadlocks exists for 5m | |`{TEMPLATE_NAME:mssql.number_deadlocks_sec.max(5m)}>0` |AVERAGE | |
|MSSQL: DB {#DBNAME} in emergency mode | |`{TEMPLATE_NAME:db.odbc.select[{#DBNAME}_status,{$MSSQL.DSN}].band(,32768)}<>0` |HIGH | |
|MSSQL: DB {#DBNAME} is loading | |`{TEMPLATE_NAME:db.odbc.select[{#DBNAME}_status,{$MSSQL.DSN}].band(,32)}<>0` |HIGH | |
|MSSQL: DB {#DBNAME} is not recovered | |`{TEMPLATE_NAME:db.odbc.select[{#DBNAME}_status,{$MSSQL.DSN}].band(,256)}<>0` |HIGH | |
|MSSQL: DB {#DBNAME} is offline | |`{TEMPLATE_NAME:db.odbc.select[{#DBNAME}_status,{$MSSQL.DSN}].band(,512)}<>0` |HIGH | |
|MSSQL: DB {#DBNAME} is recovering | |`{TEMPLATE_NAME:db.odbc.select[{#DBNAME}_status,{$MSSQL.DSN}].band(,128)}<>0` |HIGH | |
|MSSQL: Log Flush Waits/sec {#DBNAME} | |`{TEMPLATE_NAME:mssql.log_flush_waits_sec[{#DBNAME}].min(5m)}>1` |WARNING | |
|MSSQL: Log Flush Wait Time {#DBNAME} | |`{TEMPLATE_NAME:mssql.log_flush_wait_time[{#DBNAME}].min(5m)}>5` |WARNING | |
|MSSQL: Log Growths {#DBNAME} | |`{TEMPLATE_NAME:mssql.log_growths[{#DBNAME}].min(5m)}>1` |WARNING | |
|MSSQL: Log Shrinks {#DBNAME} | |`{TEMPLATE_NAME:mssql.log_shrinks[{#DBNAME}].min(5m)}>15` |WARNING | |
|MSSQL: Percent Log Used {#DBNAME} | |`{TEMPLATE_NAME:mssql.percent_log_used[{#DBNAME}].min(5m)}>80` |WARNING | |

## Feedback

Please report any issues with the template at https://support.zabbix.com

You can also provide a feedback, discuss the template or ask for help with it at [ZABBIX forums]().

